<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Flowchart for Plant Watering System</title>
    <script type="module">
      // load mermaid
      import mermaid from "https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs";
      mermaid.initialize({
        startOnLoad: true,
        themeVariables: {
          fontSize: "24px", // increase font size to 24px for better readability
        },
      });
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
      /* set the size of the flowchart without scaling */
      .mermaid {
        background-color: #f9f9f9; /* light background for contrast */
        border: 1px solid #ccc; /* light border */
        padding: 10px; /* padding around the diagram */
        border-radius: 8px; /* rounded corners */
        max-width: 1000px; /* set maximum width for the diagram */
        margin: auto; /* center the chart */
      }
      /* add a button to download the image */
      #download {
        margin-top: 20px;
        padding: 10px 20px;
        background-color: #008080; /* teal background */
        color: white;
        border: none;
        border-radius: 5px;
        cursor: pointer;
      }
    </style>
  </head>
  <body>
    <h1>Flowchart for Plant Watering System</h1>
    <div class="mermaid" id="flowchart">
      flowchart TD 
        A[Start function Plant_Watering_System] --> B[Declare moisture variables]
        B --> C[reallyDryValue = 2.4] 
        B --> D[moistureThreshold = 1.6] 
        B --> E[saturatedValue = 1.6] 
        B --> F[Create graph for Dryness over Time] 
        style F fill:#f9f,stroke:#333,stroke-width:2px 
        F --> G[Set y-axis range 0 to 4] 
        G --> H[Start timer] 
        H --> I{Loop: While stop is not 1} 
        style I fill:#ffcc00,stroke:#333,stroke-width:2px 
        I --> J[Read dryness value] 
        J --> K[Update graph with dryness and time] 
        K --> L{Is dryness > reallyDryValue?} 
        style L fill:#f9f,stroke:#333,stroke-width:2px 
        L -- Yes --> M[Thirsty: Water ON] 
        L -- No --> N{Is dryness > moistureThreshold?} 
        style N fill:#f9f,stroke:#333,stroke-width:2px 
        N -- Yes --> O[A bit of water needed: Water ON] 
        N -- No --> P{Is dryness <= saturatedValue?} 
        style P fill:#f9f,stroke:#333,stroke-width:2px 
        P -- Yes --> Q[Watered: Water OFF] 
        P -- No --> R[SYSTEM FAILURE: Stop] 
        style R fill:#ff4d4d,stroke:#333,stroke-width:2px 
        Q --> I 
        M --> I 
        O --> I 
        R --> S[Stop] 
        style S fill:#ffcc00,stroke:#333,stroke-width:2px 
        style C fill:#008080,stroke:#333,stroke-width:2px 
        style D fill:#008080,stroke:#333,stroke-width:2px 
        style E fill:#008080,stroke:#333,stroke-width:2px
    </div>

    <button id="download">Download as PNG</button>

    <script>
      document.getElementById("download").onclick = function () {
        html2canvas(document.getElementById("flowchart"), {
          useCORS: true /* ensures cross-origin content is captured if any */,
          scale: 2 /* increase resolution for better quality output */,
        }).then(function (canvas) {
          // convert canvas to PNG
          var link = document.createElement("a");
          link.href = canvas.toDataURL("image/png");
          link.download = "flowchart.png";
          link.click();
        });
      };
    </script>
  </body>
</html>
